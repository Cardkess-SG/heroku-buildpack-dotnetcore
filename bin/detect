#!/usr/bin/env bash
# convenience functions
source "$(cd $(dirname $0); cd ..; pwd)"/bin/util/common.sh

PROJECT_NAME="$(get_project_name $1)"
if [[ -f "$1/${PROJECT_NAME}.csproj" && -f "$1/Startup.cs" && -f "$1/Program.cs" ]]; then
  export PROJECT_NAME
  echo "ASP.NET Core" && exit 0
else
	if [[ ${#PROJECT_NAME} -eq 0 ]]; then
		PROJECT_NAME="*"
	fi
	error <<-EOF
		Application not supported by this buildpack!

		The ASP.NET Core buildpack is set on this application, but was unable to detect
		an ASP.NET Core codebase.

		An ASP.NET Core app requires ${PROJECT_NAME}.csproj, Startup.cs and Program.cs
		files at the root of the directory structure.

		If you are trying to deploy an ASP.NET Core application, ensure that ensure that
		these files (${PROJECT_NAME}.csproj, Startup.cs and Program.cs) are present at
		the top level directory. 

		This directory has the following files:
		$(ls -1p "$1")

		If you are trying to deploy an application written in another language, you need
		to change the list of buildpacks set on your Heroku app using the 'heroku buildpacks'
		command.

		For more information, refer to the following documentation:
		https://devcenter.heroku.com/articles/buildpacks
		https://devcenter.heroku.com/articles/php-support#activation
	EOF
fi
exit 1
